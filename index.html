<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Availity Reference Architecture | PlainID</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      body { font-family: 'Inter', sans-serif; }
      .deprecated-overlay {
        position: relative;
      }
      .deprecated-overlay::after {
        content: '';
        position: absolute;
        inset: 0;
        background: repeating-linear-gradient(
          -45deg,
          transparent,
          transparent 10px,
          rgba(239, 68, 68, 0.08) 10px,
          rgba(239, 68, 68, 0.08) 20px
        );
        pointer-events: none;
        border-radius: 0.75rem;
      }
      .deprecated-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        z-index: 10;
      }
      .active-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      import React, { useState } from 'https://esm.sh/react@18.2.0'
      import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client'

      const diagramData = {
        current: { 
          id: "current", 
          label: "Current State", 
          file: "Current_State_Availity.svg",
          notesFile: "Availity-Current-With-Notes.svg",
          notesLabel: "Key Observations"
        },
        future: { id: "future", label: "Future State", file: "Future_State_Availity.svg" },
        options: [
          { id: "option1", label: "Token Enrichment", file: "Option1-TokenEnrichment.svg", status: "deprecated", statusLabel: "Not Proceeding" },
          { id: "option2", label: "TYK Plugin", file: "Option2-TYK-Plugin.svg", status: "deprecated", statusLabel: "Not Proceeding" },
          { id: "option3", label: "Istio/Envoy Sidecar", file: "Option3-Istio-Envoy-Sidecar.svg", status: "recommended", statusLabel: "Active" }
        ]
      };

      function App() {
        const [activeTab, setActiveTab] = useState("current");
        const [selectedOption, setSelectedOption] = useState(null);

        const tabs = [
          { id: "current", label: "Current State" },
          { id: "future", label: "Future State" },
          { id: "options", label: "Options" }
        ];

        const getCurrentDiagram = () => {
          if (selectedOption) {
            return diagramData.options.find(opt => opt.id === selectedOption);
          }
          if (activeTab === "current") return diagramData.current;
          if (activeTab === "future") return diagramData.future;
          return null;
        };

        const currentDiagram = getCurrentDiagram();
        const isCurrentState = activeTab === "current" && !selectedOption;

        const handleDownload = (file, label) => {
          const link = document.createElement("a");
          link.href = file;
          link.download = `${label.replace(/\//g, "-")}.svg`;
          link.click();
        };

        const e = React.createElement;

        // Header
        const header = e('header', { className: 'bg-white border-b border-neutral-200 px-8 py-5' },
          e('div', { className: 'max-w-7xl mx-auto flex items-center justify-between' },
            e('div', null,
              e('h1', { className: 'text-xl font-semibold text-neutral-900' }, 'Availity Reference Architecture'),
              e('p', { className: 'text-sm text-neutral-500' }, 'PlainID Integration')
            ),
            e('div', { className: 'flex gap-1 bg-neutral-100 p-1 rounded-lg' },
              tabs.map(tab => 
                e('button', {
                  key: tab.id,
                  onClick: () => { setActiveTab(tab.id); setSelectedOption(null); },
                  className: `px-4 py-2 rounded-md text-sm font-medium transition-all ${
                    activeTab === tab.id 
                      ? 'bg-white text-neutral-900 shadow-sm' 
                      : 'text-neutral-500 hover:text-neutral-700'
                  }`
                }, tab.label)
              )
            )
          )
        );

        // Options Grid
        const optionsGrid = e('div', { className: 'space-y-6' },
          e('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6' },
            diagramData.options.map(opt => {
              const isDeprecated = opt.status === 'deprecated';
              const isRecommended = opt.status === 'recommended';
              return e('div', {
                key: opt.id,
                onClick: () => setSelectedOption(opt.id),
                className: `relative bg-white rounded-xl p-5 border transition-all cursor-pointer ${
                  isDeprecated 
                    ? 'border-red-200 hover:border-red-300 deprecated-overlay' 
                    : isRecommended
                      ? 'border-green-300 hover:border-green-400 hover:shadow-md'
                      : 'border-neutral-200 hover:border-neutral-400 hover:shadow-md'
                }`
              },
                isDeprecated && e('div', { className: 'deprecated-badge' },
                  e('span', { 
                    className: 'inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700 border border-red-200'
                  }, 
                    e('svg', { className: 'w-3.5 h-3.5', fill: 'none', viewBox: '0 0 24 24', stroke: 'currentColor', strokeWidth: 2 },
                      e('path', { strokeLinecap: 'round', strokeLinejoin: 'round', d: 'M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636' })
                    ),
                    opt.statusLabel
                  )
                ),
                isRecommended && e('div', { className: 'active-badge' },
                  e('span', { 
                    className: 'inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700 border border-green-200'
                  }, 
                    e('svg', { className: 'w-3.5 h-3.5', fill: 'none', viewBox: '0 0 24 24', stroke: 'currentColor', strokeWidth: 2 },
                      e('path', { strokeLinecap: 'round', strokeLinejoin: 'round', d: 'M5 13l4 4L19 7' })
                    ),
                    opt.statusLabel
                  )
                ),
                e('div', { 
                  className: `aspect-video rounded-lg mb-4 flex items-center justify-center overflow-hidden ${
                    isDeprecated ? 'bg-red-50/50' : isRecommended ? 'bg-green-50/50' : 'bg-neutral-50'
                  }`
                },
                  e('img', { 
                    src: opt.file, 
                    alt: opt.label, 
                    className: `w-full h-full object-contain p-2 ${isDeprecated ? 'opacity-60' : ''}`
                  })
                ),
                e('h3', { 
                  className: `font-medium text-center ${isDeprecated ? 'text-red-700' : isRecommended ? 'text-green-700' : 'text-neutral-700'}`
                }, opt.label),
                isDeprecated && e('p', { 
                  className: 'text-xs text-center text-red-500 mt-1'
                }, 'This option will not be implemented')
              );
            })
          ),
          e('p', { className: 'text-center text-neutral-400 text-sm' }, 'Select an option to view details')
        );

        // Diagram View
        const diagramView = e('div', { className: 'bg-white rounded-xl p-6 border border-neutral-200 shadow-sm' },
          selectedOption && e('button', {
            onClick: () => setSelectedOption(null),
            className: 'text-neutral-400 hover:text-neutral-600 mb-4 text-sm flex items-center gap-1 transition-colors'
          }, '← Back to options'),
          e('div', { className: 'flex items-center justify-between mb-4' },
            e('div', { className: 'flex items-center gap-3' },
              e('h3', { className: 'text-lg font-semibold text-neutral-800' }, currentDiagram?.label),
              currentDiagram?.status === 'deprecated' && e('span', { 
                className: 'inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700 border border-red-200'
              }, 
                e('svg', { className: 'w-3.5 h-3.5', fill: 'none', viewBox: '0 0 24 24', stroke: 'currentColor', strokeWidth: 2 },
                  e('path', { strokeLinecap: 'round', strokeLinejoin: 'round', d: 'M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636' })
                ),
                'Not Proceeding'
              ),
              currentDiagram?.status === 'recommended' && e('span', { 
                className: 'inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700 border border-green-200'
              }, 
                e('svg', { className: 'w-3.5 h-3.5', fill: 'none', viewBox: '0 0 24 24', stroke: 'currentColor', strokeWidth: 2 },
                  e('path', { strokeLinecap: 'round', strokeLinejoin: 'round', d: 'M5 13l4 4L19 7' })
                ),
                'Active'
              )
            ),
            // Download buttons - show two for Current State, one for others
            isCurrentState 
              ? e('div', { className: 'flex gap-2' },
                  e('button', {
                    onClick: () => handleDownload(currentDiagram.file, currentDiagram.label),
                    className: 'px-4 py-2 bg-neutral-100 hover:bg-neutral-200 rounded-lg text-sm font-medium text-neutral-600 transition-colors'
                  }, '↓ Download Diagram'),
                  e('button', {
                    onClick: () => handleDownload(currentDiagram.notesFile, currentDiagram.notesLabel),
                    className: 'px-4 py-2 bg-neutral-100 hover:bg-neutral-200 rounded-lg text-sm font-medium text-neutral-600 transition-colors'
                  }, '↓ Download Key Observations')
                )
              : e('button', {
                  onClick: () => handleDownload(currentDiagram?.file, currentDiagram?.label),
                  className: 'px-4 py-2 bg-neutral-100 hover:bg-neutral-200 rounded-lg text-sm font-medium text-neutral-600 transition-colors'
                }, '↓ Download')
          ),
          currentDiagram?.status === 'deprecated' && e('div', {
            className: 'mb-4 p-3 bg-red-50 border border-red-200 rounded-lg'
          },
            e('p', { className: 'text-sm text-red-700' },
              e('strong', null, 'Note: '),
              'This integration option has been evaluated and will not be implemented. The diagram is preserved for reference purposes only.'
            )
          ),
          // Main diagram
          e('div', { 
            className: `rounded-lg flex items-center justify-center border overflow-hidden ${
              currentDiagram?.status === 'deprecated' 
                ? 'bg-red-50/30 border-red-100' 
                : 'bg-neutral-50 border-neutral-100'
            }`
          },
            e('img', { 
              src: currentDiagram?.file, 
              alt: currentDiagram?.label, 
              className: `w-full h-auto ${currentDiagram?.status === 'deprecated' ? 'opacity-75' : ''}`
            })
          ),
          // Key Observations section - only for Current State
          isCurrentState && e('div', { className: 'mt-8' },
            e('h4', { className: 'text-md font-semibold text-neutral-800 mb-4' }, 'Key Observations'),
            e('div', { 
              className: 'rounded-lg flex items-center justify-center border overflow-hidden bg-neutral-50 border-neutral-100'
            },
              e('img', { 
                src: currentDiagram.notesFile, 
                alt: currentDiagram.notesLabel, 
                className: 'w-full h-auto'
              })
            )
          )
        );

        // Main content
        const main = e('main', { className: 'max-w-7xl mx-auto p-8' },
          activeTab === "options" && !selectedOption ? optionsGrid : diagramView
        );

        return e('div', { className: 'min-h-screen bg-neutral-50 text-neutral-900' }, header, main);
      }

      const root = createRoot(document.getElementById('root'));
      root.render(React.createElement(App));
    </script>
  </body>
</html>
